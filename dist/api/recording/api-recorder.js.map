{"version":3,"file":"api-recorder.js","names":["recordingStore","isRecordingActive","isNotRecordingApiPath","apiUrl","path","indexOf","startNewRecording","uuid","uuidv1","stopRecording","recording","Object","keys","length","apiRecorder","req","res","next","originalSend","send","body","call","forEach","recordUuid","push","url","baseUrl","method","params","query","responseBody","JSON","parse"],"sources":["../../../lib/api/recording/api-recorder.js"],"sourcesContent":["import { v1 as uuidv1 } from 'uuid';\n\nconst recordingStore = {};\nlet isRecordingActive = false;\n\nconst isNotRecordingApiPath = (apiUrl, path) => {\n  return path.indexOf(`${apiUrl}/recording/`) === -1;\n};\n\nexport const startNewRecording = () => {\n  const uuid = uuidv1();\n  recordingStore[uuid] = [];\n  isRecordingActive = true;\n  return uuid;\n};\n\nexport const stopRecording = (uuid) => {\n  const recording = recordingStore[uuid];\n  delete recordingStore[uuid];\n  isRecordingActive = Object.keys(recordingStore).length > 0;\n  return recording;\n};\n\nexport const apiRecorder = (apiUrl) => {\n  return (req, res, next) => {\n    if (isRecordingActive && isNotRecordingApiPath(apiUrl, req.path)) {\n      const originalSend = res.send;\n      res.send = function (body) {\n        originalSend.call(this, body);\n\n        Object.keys(recordingStore).forEach((recordUuid) => {\n          recordingStore[recordUuid].push({\n            url: req.baseUrl,\n            path: req.path,\n            method: req.method,\n            params: req.params,\n            query: req.query,\n            body: req.body,\n            responseBody: !body ? {} : JSON.parse(body),\n          });\n        });\n      };\n    }\n\n    next();\n  };\n};\n"],"mappings":";;;;;;;AAAA;;AAEA,MAAMA,cAAc,GAAG,EAAvB;AACA,IAAIC,iBAAiB,GAAG,KAAxB;;AAEA,MAAMC,qBAAqB,GAAG,CAACC,MAAD,EAASC,IAAT,KAAkB;EAC9C,OAAOA,IAAI,CAACC,OAAL,CAAc,GAAEF,MAAO,aAAvB,MAAyC,CAAC,CAAjD;AACD,CAFD;;AAIO,MAAMG,iBAAiB,GAAG,MAAM;EACrC,MAAMC,IAAI,GAAG,IAAAC,QAAA,GAAb;EACAR,cAAc,CAACO,IAAD,CAAd,GAAuB,EAAvB;EACAN,iBAAiB,GAAG,IAApB;EACA,OAAOM,IAAP;AACD,CALM;;;;AAOA,MAAME,aAAa,GAAIF,IAAD,IAAU;EACrC,MAAMG,SAAS,GAAGV,cAAc,CAACO,IAAD,CAAhC;EACA,OAAOP,cAAc,CAACO,IAAD,CAArB;EACAN,iBAAiB,GAAGU,MAAM,CAACC,IAAP,CAAYZ,cAAZ,EAA4Ba,MAA5B,GAAqC,CAAzD;EACA,OAAOH,SAAP;AACD,CALM;;;;AAOA,MAAMI,WAAW,GAAIX,MAAD,IAAY;EACrC,OAAO,CAACY,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;IACzB,IAAIhB,iBAAiB,IAAIC,qBAAqB,CAACC,MAAD,EAASY,GAAG,CAACX,IAAb,CAA9C,EAAkE;MAChE,MAAMc,YAAY,GAAGF,GAAG,CAACG,IAAzB;;MACAH,GAAG,CAACG,IAAJ,GAAW,UAAUC,IAAV,EAAgB;QACzBF,YAAY,CAACG,IAAb,CAAkB,IAAlB,EAAwBD,IAAxB;QAEAT,MAAM,CAACC,IAAP,CAAYZ,cAAZ,EAA4BsB,OAA5B,CAAqCC,UAAD,IAAgB;UAClDvB,cAAc,CAACuB,UAAD,CAAd,CAA2BC,IAA3B,CAAgC;YAC9BC,GAAG,EAAEV,GAAG,CAACW,OADqB;YAE9BtB,IAAI,EAAEW,GAAG,CAACX,IAFoB;YAG9BuB,MAAM,EAAEZ,GAAG,CAACY,MAHkB;YAI9BC,MAAM,EAAEb,GAAG,CAACa,MAJkB;YAK9BC,KAAK,EAAEd,GAAG,CAACc,KALmB;YAM9BT,IAAI,EAAEL,GAAG,CAACK,IANoB;YAO9BU,YAAY,EAAE,CAACV,IAAD,GAAQ,EAAR,GAAaW,IAAI,CAACC,KAAL,CAAWZ,IAAX;UAPG,CAAhC;QASD,CAVD;MAWD,CAdD;IAeD;;IAEDH,IAAI;EACL,CArBD;AAsBD,CAvBM"}