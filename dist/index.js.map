{"version":3,"file":"index.js","names":["port","config","server","wsServer","serverStart","sources","serverConfig","app","App","getServerPort","start","console","log","yellow","bgGreen","white","cors","initCors","webSocketEnabled","startWebSocket","initWebSocketApi","serverStop","close","ws","Server","noServer","on","socket","message","request","head","handleUpgrade","emit"],"sources":["../lib/index.js"],"sourcesContent":["import 'colors';\nimport config from './config';\nimport { App } from './app';\nimport ws from 'ws';\n\nconst { port } = config;\nlet server,\n  wsServer = null;\n\n/**\n * Method to start server.\n *\n * @param sources\n * @param {Object} serverConfig\n * @param serverConfig.controlApiUrl    ['/api/v1']\n * @param serverConfig.port             [8080]\n * @param serverConfig.webSocketEnabled false\n * @param serverConfig.cors false\n */\nexport function serverStart(sources, serverConfig = {}) {\n  const app = new App(sources, serverConfig);\n  const port = getServerPort(serverConfig);\n  server = app.start(port, () => {\n    console.log(`* Server port    ${port}`.yellow);\n    console.log(`*************************`.yellow);\n    console.log('Server START'.bgGreen.white);\n  });\n\n  if (serverConfig.cors) {\n    console.log(`*************************`.yellow);\n    console.log(`Cors Enabled`);\n    app.initCors();\n  }\n\n  if (serverConfig.webSocketEnabled) {\n    wsServer = startWebSocket(server);\n    app.initWebSocketApi(wsServer);\n  }\n\n  return server;\n}\n\n/**\n * Method to stop server.\n */\nexport function serverStop() {\n  if (server) {\n    server.close();\n  }\n  if (wsServer) {\n    wsServer.close();\n  }\n}\n\nfunction startWebSocket(server) {\n  const wsServer = new ws.Server({ noServer: true });\n  wsServer.on('connection', (socket) => {\n    console.log('WebSocket client connected');\n    socket.on('message', (message) => {\n      console.log('WebSocket client message received');\n      console.log(message);\n    });\n    socket.on('close', () => console.log('WebSocket client disconnected'));\n  });\n\n  server.on('upgrade', (request, socket, head) => {\n    wsServer.handleUpgrade(request, socket, head, (socket) => {\n      wsServer.emit('connection', socket, request);\n    });\n  });\n\n  return wsServer;\n}\n\nfunction getServerPort(serverConfig) {\n  return serverConfig.port ? serverConfig.port : port;\n}\n"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA,MAAM;EAAEA;AAAF,IAAWC,eAAjB;AACA,IAAIC,MAAJ;AAAA,IACEC,QAAQ,GAAG,IADb;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,WAAT,CAAqBC,OAArB,EAA8BC,YAAY,GAAG,EAA7C,EAAiD;EACtD,MAAMC,GAAG,GAAG,IAAIC,QAAJ,CAAQH,OAAR,EAAiBC,YAAjB,CAAZ;EACA,MAAMN,IAAI,GAAGS,aAAa,CAACH,YAAD,CAA1B;EACAJ,MAAM,GAAGK,GAAG,CAACG,KAAJ,CAAUV,IAAV,EAAgB,MAAM;IAC7BW,OAAO,CAACC,GAAR,CAAa,oBAAmBZ,IAAK,EAAzB,CAA2Ba,MAAvC;IACAF,OAAO,CAACC,GAAR,CAAa,2BAAD,CAA4BC,MAAxC;IACAF,OAAO,CAACC,GAAR,CAAY,eAAeE,OAAf,CAAuBC,KAAnC;EACD,CAJQ,CAAT;;EAMA,IAAIT,YAAY,CAACU,IAAjB,EAAuB;IACrBL,OAAO,CAACC,GAAR,CAAa,2BAAD,CAA4BC,MAAxC;IACAF,OAAO,CAACC,GAAR,CAAa,cAAb;IACAL,GAAG,CAACU,QAAJ;EACD;;EAED,IAAIX,YAAY,CAACY,gBAAjB,EAAmC;IACjCf,QAAQ,GAAGgB,cAAc,CAACjB,MAAD,CAAzB;IACAK,GAAG,CAACa,gBAAJ,CAAqBjB,QAArB;EACD;;EAED,OAAOD,MAAP;AACD;AAED;AACA;AACA;;;AACO,SAASmB,UAAT,GAAsB;EAC3B,IAAInB,MAAJ,EAAY;IACVA,MAAM,CAACoB,KAAP;EACD;;EACD,IAAInB,QAAJ,EAAc;IACZA,QAAQ,CAACmB,KAAT;EACD;AACF;;AAED,SAASH,cAAT,CAAwBjB,MAAxB,EAAgC;EAC9B,MAAMC,QAAQ,GAAG,IAAIoB,WAAA,CAAGC,MAAP,CAAc;IAAEC,QAAQ,EAAE;EAAZ,CAAd,CAAjB;EACAtB,QAAQ,CAACuB,EAAT,CAAY,YAAZ,EAA2BC,MAAD,IAAY;IACpChB,OAAO,CAACC,GAAR,CAAY,4BAAZ;IACAe,MAAM,CAACD,EAAP,CAAU,SAAV,EAAsBE,OAAD,IAAa;MAChCjB,OAAO,CAACC,GAAR,CAAY,mCAAZ;MACAD,OAAO,CAACC,GAAR,CAAYgB,OAAZ;IACD,CAHD;IAIAD,MAAM,CAACD,EAAP,CAAU,OAAV,EAAmB,MAAMf,OAAO,CAACC,GAAR,CAAY,+BAAZ,CAAzB;EACD,CAPD;EASAV,MAAM,CAACwB,EAAP,CAAU,SAAV,EAAqB,CAACG,OAAD,EAAUF,MAAV,EAAkBG,IAAlB,KAA2B;IAC9C3B,QAAQ,CAAC4B,aAAT,CAAuBF,OAAvB,EAAgCF,MAAhC,EAAwCG,IAAxC,EAA+CH,MAAD,IAAY;MACxDxB,QAAQ,CAAC6B,IAAT,CAAc,YAAd,EAA4BL,MAA5B,EAAoCE,OAApC;IACD,CAFD;EAGD,CAJD;EAMA,OAAO1B,QAAP;AACD;;AAED,SAASM,aAAT,CAAuBH,YAAvB,EAAqC;EACnC,OAAOA,YAAY,CAACN,IAAb,GAAoBM,YAAY,CAACN,IAAjC,GAAwCA,IAA/C;AACD"}